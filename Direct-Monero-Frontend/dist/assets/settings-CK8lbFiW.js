import{V as B,a as j}from"./VRow-BS03yX6S.js";import{V as z,c as $,d as fe,a as q,b as A}from"./VCard-DFEzo_lP.js";import{V as ae,a as P}from"./VForm-DSaG_7mw.js";import{V as T,e as be,k as Pe,h as ke,i as se,l as Ce,o as Ne,p as De,f as Ue}from"./VTextField-DWI3MSZh.js";import{V as J}from"./index-iYrz7fL7.js";import{i as E,I as Fe,_ as Ie}from"./VContainer-Bd8Dxbcf.js";import{v as r,E as w,G as _,H as a,A as e,I as U,J as y,M as h,Z as k,p as Se,j as Ae,q as Te,c as K,s as Re,d as Be,o as me,w as R,b as je,z as ze,aF as $e,B as Q,F as X,al as ue,am as qe,aG as Ee,D as ee,aH as Oe,a as Ge,a8 as He,N as Me}from"./index-CrBq_UzM.js";import{V as Ke,a as re,b as ie,d as de,c as ce}from"./VList-zTHY8DS8.js";import{V as Je}from"./VSpacer-Cj_HJSnj.js";const Le={__name:"DeleteAccount",emits:["accountDeleted"],setup(t,{emit:p}){const c=r(""),m=r(""),u=r(!1),n=r(""),s=r(""),l=[f=>!!f||"Username is required"],i=[f=>!!f||"Confirmation is required",f=>f==="I confirm"||'You must type "I confirm" to delete your account'],g=p,b=async()=>{const f=localStorage.getItem("token"),o=void 0;try{const d=await fetch(`${o}/api/user/delete_account`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({username:c.value})});if(!d.ok)throw new Error("Failed to delete account, make sure its your username not your display name");const F=await d.json();n.value=F.message,s.value="",g("accountDeleted"),window.location.href="/"}catch(d){s.value=d.message,n.value=""}};return(f,o)=>(w(),_(E,null,{default:a(()=>[e(B,{justify:"center"},{default:a(()=>[e(j,{cols:"12",md:"10"},{default:a(()=>[e(z,{class:"elevation-12"},{default:a(()=>[e($,null,{default:a(()=>o[3]||(o[3]=[U("span",{class:"headline"},"Delete Account",-1)])),_:1}),e(fe,null,{default:a(()=>o[4]||(o[4]=[U("span",{style:{color:"red","font-weight":"bold"}},'Warning: This action is irreversible. Please enter your username and type "I confirm" to delete your account.',-1)])),_:1}),e(q,null,{default:a(()=>[e(ae,{ref:"form",modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=d=>u.value=d),"lazy-validation":""},{default:a(()=>[e(T,{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=d=>c.value=d),rules:l,label:"Username",required:""},null,8,["modelValue"]),e(T,{modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=d=>m.value=d),rules:i,label:'Type "I confirm"',required:""},null,8,["modelValue"]),e(J,{disabled:!u.value,color:"primary",onClick:b},{default:a(()=>o[5]||(o[5]=[y(" Delete Account ")])),_:1},8,["disabled"]),n.value?(w(),_(P,{key:0,type:"success"},{default:a(()=>[y(h(n.value),1)]),_:1})):k("",!0),s.value?(w(),_(P,{key:1,type:"error"},{default:a(()=>[y(h(s.value),1)]),_:1})):k("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Ze={__name:"ChangeDisplayName",setup(t){const p=r(""),c=r(!1),m=r(""),u=r(""),n=[l=>!!l||"Display name is required",l=>l&&l.length<=50||"Display name must be less than 50 characters",l=>l&&(l.match(/\d/g)||[]).length>=4||"Display name must contain at least 4 numbers",l=>l&&(l.match(/[a-zA-Z]/g)||[]).length>=2||"Display name must contain more than 2 letters"],s=async()=>{const l=localStorage.getItem("token"),i=void 0;try{const b=await fetch(`${i}/api/profile/change_display_name`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({displayName:p.value})});if(!b.ok)throw new Error("Failed to change display name");const f=await b.json();m.value=f.message,u.value=""}catch(g){u.value=g.message,m.value=""}};return(l,i)=>(w(),_(E,null,{default:a(()=>[e(B,{justify:"center"},{default:a(()=>[e(j,{cols:"12",md:"10"},{default:a(()=>[e(z,{class:"elevation-12"},{default:a(()=>[e($,null,{default:a(()=>i[2]||(i[2]=[U("span",{class:"headline"},"Change Display Name",-1)])),_:1}),e(fe,null,{default:a(()=>i[3]||(i[3]=[U("span",{style:{color:"red","font-weight":"bold"}},"Disclaimer: Use a generic name to protect your privacy",-1)])),_:1}),e(q,null,{default:a(()=>[e(ae,{ref:"form",modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=g=>c.value=g),"lazy-validation":""},{default:a(()=>[e(T,{modelValue:p.value,"onUpdate:modelValue":i[0]||(i[0]=g=>p.value=g),rules:n,label:"New Display Name",required:""},null,8,["modelValue"]),e(J,{disabled:!c.value,color:"primary",onClick:s},{default:a(()=>i[4]||(i[4]=[y(" Change Display Name ")])),_:1},8,["disabled"]),m.value?(w(),_(P,{key:0,type:"success"},{default:a(()=>[y(h(m.value),1)]),_:1})):k("",!0),u.value?(w(),_(P,{key:1,type:"error"},{default:a(()=>[y(h(u.value),1)]),_:1})):k("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},We={__name:"ChangePassword",setup(t){const p=r(""),c=r(""),m=r(""),u=r(""),n=r(""),s=r(!1),l=[f=>!!f||"Old Password is required."],i=[f=>!!f||"New Password is required.",f=>f.length>=6||"New Password must be at least 6 characters long."],g=[f=>!!f||"Confirm Password is required.",f=>f===c.value||"Passwords do not match."],b=async()=>{const f=localStorage.getItem("token"),d=await fetch("undefined/api/user/change_password",{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({oldPassword:p.value,newPassword:c.value})});if(d.ok)u.value="Password changed successfully!",n.value="",p.value="",c.value="",m.value="";else{const F=await d.json();n.value=F.message||"An error occurred while changing the password.",u.value=""}};return(f,o)=>(w(),_(E,null,{default:a(()=>[e(B,{justify:"center"},{default:a(()=>[e(j,{cols:"12",md:"10"},{default:a(()=>[e(z,{class:"elevation-12"},{default:a(()=>[e($,null,{default:a(()=>o[4]||(o[4]=[U("span",{class:"headline"},"Change Password",-1)])),_:1}),e(q,null,{default:a(()=>[e(ae,{ref:"form",modelValue:s.value,"onUpdate:modelValue":o[3]||(o[3]=d=>s.value=d),"lazy-validation":""},{default:a(()=>[e(T,{modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=d=>p.value=d),rules:l,label:"Old Password",type:"password",required:""},null,8,["modelValue"]),e(T,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=d=>c.value=d),rules:i,label:"New Password",type:"password",required:""},null,8,["modelValue"]),e(T,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=d=>m.value=d),rules:g,label:"Confirm New Password",type:"password",required:""},null,8,["modelValue"]),n.value?(w(),_(P,{key:0,type:"error",dismissible:""},{default:a(()=>[y(h(n.value),1)]),_:1})):k("",!0),u.value?(w(),_(P,{key:1,type:"success",dismissible:""},{default:a(()=>[y(h(u.value),1)]),_:1})):k("",!0)]),_:1},8,["modelValue"])]),_:1}),e(A,null,{default:a(()=>[e(J,{disabled:!s.value,color:"primary",onClick:b},{default:a(()=>o[5]||(o[5]=[y("Change Password")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Ye=Se({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:t=>!isNaN(parseFloat(t))},maxRows:{type:[Number,String],validator:t=>!isNaN(parseFloat(t))},suffix:String,modelModifiers:Object,...be(),...Pe()},"VTextarea"),Qe=Ae()({name:"VTextarea",directives:{Intersect:Fe},inheritAttrs:!1,props:Ye(),emits:{"click:control":t=>!0,"mousedown:control":t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,p){let{attrs:c,emit:m,slots:u}=p;const n=Te(t,"modelValue"),{isFocused:s,focus:l,blur:i}=ke(t),g=K(()=>typeof t.counterValue=="function"?t.counterValue(n.value):(n.value||"").toString().length),b=K(()=>{if(c.maxlength)return c.maxlength;if(!(!t.counter||typeof t.counter!="number"&&typeof t.counter!="string"))return t.counter});function f(v,x){var V,C;!t.autofocus||!v||(C=(V=x[0].target)==null?void 0:V.focus)==null||C.call(V)}const o=r(),d=r(),F=Re(""),O=r(),ve=K(()=>t.persistentPlaceholder||s.value||t.active);function L(){var v;O.value!==document.activeElement&&((v=O.value)==null||v.focus()),s.value||l()}function pe(v){L(),m("click:control",v)}function ye(v){m("mousedown:control",v)}function ge(v){v.stopPropagation(),L(),ee(()=>{n.value="",Oe(t["onClick:clear"],v)})}function we(v){var V;const x=v.target;if(n.value=x.value,(V=t.modelModifiers)!=null&&V.trim){const C=[x.selectionStart,x.selectionEnd];ee(()=>{x.selectionStart=C[0],x.selectionEnd=C[1]})}}const I=r(),G=r(+t.rows),Z=K(()=>["plain","underlined"].includes(t.variant));Be(()=>{t.autoGrow||(G.value=+t.rows)});function S(){t.autoGrow&&ee(()=>{if(!I.value||!d.value)return;const v=getComputedStyle(I.value),x=getComputedStyle(d.value.$el),V=parseFloat(v.getPropertyValue("--v-field-padding-top"))+parseFloat(v.getPropertyValue("--v-input-padding-top"))+parseFloat(v.getPropertyValue("--v-field-padding-bottom")),C=I.value.scrollHeight,H=parseFloat(v.lineHeight),W=Math.max(parseFloat(t.rows)*H+V,parseFloat(x.getPropertyValue("--v-input-control-height"))),Y=parseFloat(t.maxRows)*H+V||1/0,D=He(C??0,W,Y);G.value=Math.floor((D-V)/H),F.value=Ge(D)})}me(S),R(n,S),R(()=>t.rows,S),R(()=>t.maxRows,S),R(()=>t.density,S);let N;return R(I,v=>{v?(N=new ResizeObserver(S),N.observe(I.value)):N==null||N.disconnect()}),je(()=>{N==null||N.disconnect()}),ze(()=>{const v=!!(u.counter||t.counter||t.counterValue),x=!!(v||u.details),[V,C]=$e(c),{modelValue:H,...W}=se.filterProps(t),Y=Ce(t);return e(se,Q({ref:o,modelValue:n.value,"onUpdate:modelValue":D=>n.value=D,class:["v-textarea v-text-field",{"v-textarea--prefixed":t.prefix,"v-textarea--suffixed":t.suffix,"v-text-field--prefixed":t.prefix,"v-text-field--suffixed":t.suffix,"v-textarea--auto-grow":t.autoGrow,"v-textarea--no-resize":t.noResize||t.autoGrow,"v-input--plain-underlined":Z.value},t.class],style:t.style},V,W,{centerAffix:G.value===1&&!Z.value,focused:s.value}),{...u,default:D=>{let{id:M,isDisabled:te,isDirty:le,isReadonly:_e,isValid:Ve}=D;return e(Ne,Q({ref:d,style:{"--v-textarea-control-height":F.value},onClick:pe,onMousedown:ye,"onClick:clear":ge,"onClick:prependInner":t["onClick:prependInner"],"onClick:appendInner":t["onClick:appendInner"]},Y,{id:M.value,active:ve.value||le.value,centerAffix:G.value===1&&!Z.value,dirty:le.value||t.dirty,disabled:te.value,focused:s.value,error:Ve.value===!1}),{...u,default:he=>{let{props:{class:ne,...oe}}=he;return e(X,null,[t.prefix&&e("span",{class:"v-text-field__prefix"},[t.prefix]),ue(e("textarea",Q({ref:O,class:ne,value:n.value,onInput:we,autofocus:t.autofocus,readonly:_e.value,disabled:te.value,placeholder:t.placeholder,rows:t.rows,name:t.name,onFocus:L,onBlur:i},oe,C),null),[[qe("intersect"),{handler:f},null,{once:!0}]]),t.autoGrow&&ue(e("textarea",{class:[ne,"v-textarea__sizer"],id:`${oe.id}-sizer`,"onUpdate:modelValue":xe=>n.value=xe,ref:I,readonly:!0,"aria-hidden":"true"},null),[[Ee,n.value]]),t.suffix&&e("span",{class:"v-text-field__suffix"},[t.suffix])])}})},details:x?D=>{var M;return e(X,null,[(M=u.details)==null?void 0:M.call(u,D),v&&e(X,null,[e("span",null,null),e(De,{active:t.persistentCounter||s.value,value:g.value,max:b.value,disabled:t.disabled},u.counter)])])}:void 0})}),Ue({},o,d,O)}}),Xe={__name:"PublicKey",setup(t){const p=r(""),c=r(""),m=r(""),u=async()=>{try{const n=localStorage.getItem("token"),l=await fetch("undefined/api/profile/public_key",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({public_key:p.value})});if(!l.ok)throw new Error("Failed to update public key");const i=await l.json();c.value=i.message||"Public key updated successfully",m.value="",p.value=""}catch(n){m.value=n.message,c.value=""}};return(n,s)=>(w(),_(E,null,{default:a(()=>[e(B,{justify:"center"},{default:a(()=>[e(j,{cols:"12",md:"10"},{default:a(()=>[e(z,{class:"elevation-12"},{default:a(()=>[e($,null,{default:a(()=>s[1]||(s[1]=[U("span",{class:"headline"},"Update Public Key",-1)])),_:1}),e(q,null,{default:a(()=>[e(Qe,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=l=>p.value=l),label:"PGP Public Key",placeholder:"Enter your PGP public key",outlined:"",required:"",rows:"10",counter:"900"},null,8,["modelValue"]),m.value?(w(),_(P,{key:0,type:"error",dismissible:""},{default:a(()=>[y(h(m.value),1)]),_:1})):k("",!0),c.value?(w(),_(P,{key:1,type:"success",dismissible:""},{default:a(()=>[y(h(c.value),1)]),_:1})):k("",!0)]),_:1}),e(A,null,{default:a(()=>[e(J,{color:"primary",onClick:u},{default:a(()=>s[2]||(s[2]=[y("Update")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},ea={__name:"settings",setup(t){const p=r(""),c=r(""),m=r(""),u=r(""),n=async()=>{const s=localStorage.getItem("token");try{const i=await fetch("undefined/api/profile/me",{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!i.ok)throw new Error("Failed to fetch user profile");const g=await i.json();p.value=g.displayName,c.value=g.public_key||"Not set",m.value=""}catch(l){console.error("Error fetching user profile:",l),l.value="Failed to fetch user profile"}};return me(()=>{n()}),(s,l)=>{const i=Me("v-list-item-content"),g=Ze,b=Le;return w(),_(E,null,{default:a(()=>[e(B,{justify:"center"},{default:a(()=>[e(j,{cols:"12",md:"8"},{default:a(()=>[e(z,{class:"elevation-12"},{default:a(()=>[e($,null,{default:a(()=>l[0]||(l[0]=[U("span",{class:"headline"},"User Profile",-1)])),_:1}),e(q,null,{default:a(()=>[e(Ke,null,{default:a(()=>[e(re,null,{default:a(()=>[e(i,null,{default:a(()=>[e(ie,null,{default:a(()=>l[1]||(l[1]=[y("DisplayName:")])),_:1}),e(de,null,{default:a(()=>[y(h(p.value),1)]),_:1})]),_:1})]),_:1}),e(re,null,{default:a(()=>[e(i,null,{default:a(()=>[e(ie,null,{default:a(()=>l[2]||(l[2]=[y("Public Key:")])),_:1}),e(de,null,{default:a(()=>[y(h(c.value),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(ce),u.value?(w(),_(P,{key:0,type:"error",dismissible:""},{default:a(()=>[y(h(u.value),1)]),_:1})):k("",!0),m.value?(w(),_(P,{key:1,type:"success",dismissible:""},{default:a(()=>[y(h(m.value),1)]),_:1})):k("",!0)]),_:1}),e(A,null,{default:a(()=>[e(Xe,{onUpdate:n})]),_:1}),e(ce),e(A,null,{default:a(()=>[e(We,{onPasswordChanged:n})]),_:1}),e(A,null,{default:a(()=>[e(g,{onDisplayNameChanged:n})]),_:1}),e(A,null,{default:a(()=>[e(b,{onAccountDeleted:s.handleAccountDeletion},null,8,["onAccountDeleted"])]),_:1})]),_:1}),e(Je)]),_:1})]),_:1})]),_:1})}}},da=Ie(ea,[["__scopeId","data-v-848bdd43"]]);export{da as default};
